<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Mongoose  v0.0.0</title><link href="http://fonts.googleapis.com/css?family=Anonymous+Pro:400,700|Droid+Sans+Mono|Open+Sans:400,700|Linden+Hill|Quattrocento:400,700|News+Cycle:400,700|Antic+Slab|Cabin+Condensed:400,700" rel="stylesheet" type="text/css"><link href="css/default.css" rel="stylesheet" type="text/css"><link href="css/guide.css" rel="stylesheet" type="text/css"></head><body><a id="forkbanner" href="http://github.com/learnboost/mongoose"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a><div id="links"><div id="header"><h1><a href="../index.html"><div class="mongoose">Mongoose</div></a></h1></div></div><div id="content"><div class="module"><gcse:search></gcse:search><h1 class="contents" id="browser:document">describe browser:document</h1><p class="comments">  Browser tests for documentation </p> <h2 class="contents" id="works">it works</h2><p class="comments">    It does what it is supp{{osed to do.   </p><p class="code"><pre><code>var obj = {
  test    : &#39;test&#39;,
  oids    : [],
  nested  : {
    age   : 5,
    cool  : mongoose.Types.ObjectId.createFromHexString(&#39;4c6c2d6240ced95d0e00003c&#39;),
    path  : &#39;my path&#39;
  }
};

var doc = new mongoose.Document(obj, schema);

assert.equal(&#39;test&#39;, doc.test);
assert.ok(doc.get(&#39;oids&#39;) instanceof Array);
assert.equal(doc.get(&#39;nested.age&#39;), 5);
assert.equal(String(doc.get(&#39;nested.cool&#39;)), &#39;4c6c2d6240ced95d0e00003c&#39;);
assert.equal(7, doc.get(&#39;nested.agePlus2&#39;));
assert.equal(&#39;5my path&#39;, doc.get(&#39;nested.path&#39;));
doc.set(&#39;nested.setAge&#39;, 10);
assert.equal(10, doc.get(&#39;nested.age&#39;));
doc.set(&#39;nested.setr&#39;, &#39;set it&#39;);
assert.equal(doc.getValue(&#39;nested.setr&#39;), &#39;set it setter&#39;);

var doc2 = new mongoose.Document(
  {
    test    : &#39;toop&#39;,
    oids    : [],
    nested  : {
      age   : 2,
      cool  : mongoose.Types.ObjectId.createFromHexString(&#39;4cf70857337498f95900001c&#39;),
      deep  : { x: &#39;yay&#39; }
    }
  },
  schema);

assert.equal(&#39;toop&#39;, doc2.get(&#39;test&#39;));
assert.ok(doc2.get(&#39;oids&#39;) instanceof Array);
assert.equal(doc2.get(&#39;nested.age&#39;), 2);

// GH-366
assert.equal(doc2.get(&#39;nested.bonk&#39;), undefined);
assert.equal(doc2.get(&#39;nested.nested&#39;), undefined);
assert.equal(doc2.get(&#39;nested.test&#39;), undefined);
assert.equal(doc2.get(&#39;nested.age.test&#39;), undefined);
assert.equal(doc2.get(&#39;nested.age.nested&#39;), undefined);
assert.equal(doc2.get(&#39;oids.nested&#39;), undefined);
assert.equal(doc2.get(&#39;nested.deep.x&#39;), &#39;yay&#39;);
assert.equal(doc2.get(&#39;nested.deep.nested&#39;), undefined);
assert.equal(doc2.get(&#39;nested.deep.cool&#39;), undefined);
assert.equal(doc2.get(&#39;nested2.yup.nested&#39;), undefined);
assert.equal(doc2.get(&#39;nested2.yup.nested2&#39;), undefined);
assert.equal(doc2.get(&#39;nested2.yup.yup&#39;), undefined);
assert.equal(doc2.get(&#39;nested2.yup.age&#39;), undefined);
assert.equal(&#39;object&#39;, typeof doc2.get(&#39;nested2.yup&#39;));

doc2.set(&#39;nested2.yup&#39;, {
  age: 150,
  yup: &quot;Yesiree&quot;,
  nested: true
});

assert.equal(doc2.get(&#39;nested2.nested&#39;), undefined);
assert.equal(doc2.get(&#39;nested2.yup.nested&#39;), true);
assert.equal(doc2.get(&#39;nested2.yup.yup&#39;), &quot;Yesiree&quot;);
assert.equal(doc2.get(&#39;nested2.yup.age&#39;), 150);
doc2.set(&#39;nested2.nested&#39;, &#39;y&#39;);
assert.equal(doc2.get(&#39;nested2.nested&#39;), &#39;y&#39;);
assert.equal(doc2.get(&#39;nested2.yup.nested&#39;), true);
assert.equal(doc2.get(&#39;nested2.yup.yup&#39;), &#39;Yesiree&#39;);
assert.equal(150, doc2.get(&#39;nested2.yup.age&#39;));

assert.equal(String(doc2.get(&#39;nested.cool&#39;)), &#39;4cf70857337498f95900001c&#39;);

assert.ok(doc.get(&#39;oids&#39;) !== doc2.get(&#39;oids&#39;));
done();
</code></pre></p> <h1 class="contents" id="browser:validate">describe browser:validate</h1> <h2 class="contents" id="works">it works</h2><p class="code"><pre><code>var called = false;
var validate = [function(str){ called = true; return true }, &#39;BAM&#39;];

schema = new Schema({
  prop: { type: String, required: true, validate: validate },
  nick: { type: String, required: true }
});

var doc = new mongoose.Document({}, schema);
doc.validate(function(error) {
  assert.ok(!!error);
  assert.ok(called);
  assert.equal(&#39;Path `prop` is required.&#39;, error.errors[&#39;prop&#39;].message);
  assert.equal(&#39;Path `nick` is required.&#39;, error.errors[&#39;nick&#39;].message);

  doc.prop = &#39;Bacon&#39;;
  doc.validate(function(error) {
    assert.ok(!error.errors[&#39;prop&#39;]);
    assert.equal(&#39;Path `nick` is required.&#39;, error.errors[&#39;nick&#39;].message);
    done();
  });
});
</code></pre></p> <h1 class="contents" id="#equals">describe #equals</h1> <h2 class="contents" id="should-work">describe should work</h2> <h3 class="contents" id="with-string-_ids">it with string _ids</h3><p class="code"><pre><code>  var s1 = new mongoose.Document({ _id: &#39;one&#39; }, S);
  var s2 = new mongoose.Document({ _id: &#39;one&#39; }, S);
  assert.ok(s1.equals(s2));
  done();
</code></pre></p> <h3 class="contents" id="with-number-_ids">it with number _ids</h3><p class="code"><pre><code>  var n1 = new mongoose.Document({ _id: 0 }, N);
  var n2 = new mongoose.Document({ _id: 0 }, N);
  assert.ok(n1.equals(n2));
  done();
</code></pre></p> <h3 class="contents" id="with-ObjectId-_ids">it with ObjectId _ids</h3><p class="code"><pre><code>  var id = new mongoose.Types.ObjectId;
  var o1 = new mongoose.Document({ _id: id }, O);
  var o2 = new mongoose.Document({ _id: id }, O);
  assert.ok(o1.equals(o2));

  id = String(new mongoose.Types.ObjectId);
  o1 = new mongoose.Document({ _id: id }, O);
  o2 = new mongoose.Document({ _id: id }, O);
  assert.ok(o1.equals(o2));
  done();
</code></pre></p> <h3 class="contents" id="with-Buffer-_ids">it with Buffer _ids</h3><p class="code"><pre><code>  var n1 = new mongoose.Document({ _id: 0 }, B);
  var n2 = new mongoose.Document({ _id: 0 }, B);
  assert.ok(n1.equals(n2));
  done();
</code></pre></p> <h3 class="contents" id="with-_id-disabled-(gh-1687)">it with _id disabled (gh-1687)</h3><p class="code"><pre><code>  var m1 = new mongoose.Document({}, M);
  var m2 = new mongoose.Document({}, M);
  assert.doesNotThrow(function () {
    m1.equals(m2)
  });
  done();
</code></pre></p></div></div></body></html>